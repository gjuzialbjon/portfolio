!function(r,z){"function"==typeof define&&define.amd?define("p5.play",["@code-dot-org/p5"],function(M){z(M)}):z("object"==typeof exports?require("@code-dot-org/p5"):r.p5)}(this,function(r){function M(t,e){Object.defineProperty(r.prototype,t,{configurable:!0,enumerable:!0,get:function(){var i=this instanceof r&&!this._isGlobal?this:window;return void 0===i._p5PlayProperties&&(i._p5PlayProperties={}),t in i._p5PlayProperties||(i._p5PlayProperties[t]=e.call(i)),i._p5PlayProperties[t]}})}function K(t){if("function"!=typeof t)throw new Error("constructor must be a function");return function(){var i=this;function s(){var o=Array.prototype.slice.call(arguments);return t.apply(this,[i].concat(o))}return s.prototype=t.prototype,s}}r.prototype.registerMethod("init",function(){this.camera=new dt(this,0,0,1),this.camera.init=!1,this.angleMode(this.DEGREES),this.frameRate(30),this._defaultCanvasSize={width:400,height:400};var e=new Date;this._startTime=e.getTime(),this._tempCanvas=document.createElement("canvas")});var R=r.prototype.abs,F=r.prototype.radians,ft=r.prototype.degrees;function k(t,e,i){i=i||0;var s=t.getBoundingClientRect(),o=e.touches[i]||e.changedTouches[i],a=o.clientX-s.left,h=o.clientY-s.top;if(a>=0&&a<s.width&&h>=0&&h<s.height)return{x:Math.round(a*t.offsetWidth/s.width),y:Math.round(h*t.offsetHeight/s.height),id:o.identifier}}function ct(t,e){var i=t.getBoundingClientRect(),s=e.clientX-i.left,o=e.clientY-i.top;if(s>=0&&s<i.width&&o>=0&&o<i.height)return{x:Math.round(s*t.offsetWidth/i.width),y:Math.round(o*t.offsetHeight/i.height)}}r.prototype.originalCreateCanvas_||(r.prototype.originalCreateCanvas_=r.prototype.createCanvas,r.prototype.createCanvas=function(){var t=this.originalCreateCanvas_.apply(this,arguments);return this.fill(this.color(127,127,127)),t}),r.prototype.originalEllipse_||(r.prototype.originalEllipse_=r.prototype.ellipse,r.prototype.ellipse=function(t,e,i,s){this.originalEllipse_(t,e,i=void 0===i?50:i,s=void 0===s?i:s)}),r.prototype.originalRect_||(r.prototype.originalRect_=r.prototype.rect,r.prototype.rect=function(t,e,i,s,o,a,h,u){this.originalRect_(t,e,i=void 0===i?50:i,s=void 0===s?i:s,o,a,h,u)}),r.prototype._ontouchstart=function(t){if(this._curElement){for(var e,i=0;i<t.touches.length&&!(e=k(this._curElement.elt,t,i));i++);if(e){var s=this._isGlobal?window:this;this._updateNextTouchCoords(t),this._updateNextMouseCoords(t),this._setProperty("touchIsDown",!0),"function"==typeof s.touchStarted?!1===s.touchStarted(t)&&t.preventDefault():"function"==typeof s.mousePressed&&!1===s.mousePressed(t)&&t.preventDefault()}}},r.prototype._updateNextTouchCoords=function(t){var e=this.touchX,i=this.touchY;if("mousedown"!==t.type&&"mousemove"!==t.type&&"mouseup"!==t.type&&t.touches){if(null!==this._curElement){var s=k(this._curElement.elt,t,0);s&&(e=s.x,i=s.y);for(var o=[],a=0,h=0;h<t.touches.length;h++)(s=k(this._curElement.elt,t,h))&&(o[a]=s,a++);this._setProperty("touches",o)}}else e=this.mouseX,i=this.mouseY;this._setProperty("touchX",e),this._setProperty("touchY",i),this._hasTouchInteracted||(this._updateTouchCoords(),this._setProperty("_hasTouchInteracted",!0))},r.prototype._onmousedown=function(t){if(this._curElement&&ct(this._curElement.elt,t)){var e=this._isGlobal?window:this;this._setProperty("isMousePressed",!0),this._setProperty("mouseIsPressed",!0),this._setMouseButton(t),this._updateNextMouseCoords(t),this._updateNextTouchCoords(t),"function"==typeof e.mousePressed?!1===e.mousePressed(t)&&t.preventDefault():"function"==typeof e.touchStarted&&!1===e.touchStarted(t)&&t.preventDefault()}},r.prototype._updateNextMouseCoords=function(t){var e=this.mouseX,i=this.mouseY;if("touchstart"===t.type||"touchmove"===t.type||"touchend"===t.type||t.touches)e=this.touchX,i=this.touchY;else if(null!==this._curElement){var s=ct(this._curElement.elt,t);s&&(e=s.x,i=s.y)}this._setProperty("mouseX",e),this._setProperty("mouseY",i),this._setProperty("winMouseX",t.pageX),this._setProperty("winMouseY",t.pageY),this._hasMouseInteracted||(this._updateMouseCoords(),this._setProperty("_hasMouseInteracted",!0))},r.Vector.project=function(t,e){return r.Vector.mult(e,r.Vector.dot(t,e)/r.Vector.dot(e,e))},r.Vector.prototype.isParallel=function(t,e){return e="number"==typeof e?e:1e-14,Math.abs(this.x)<e&&Math.abs(t.x)<e||Math.abs(this.y)<e&&Math.abs(t.y)<e||Math.abs(this.x/t.x-this.y/t.y)<e},r.prototype.loadImageElement=function(t,e,i){var s=new Image,o=r._getDecrementPreload.apply(this,arguments);return s.onload=function(){"function"==typeof e&&e(s),o&&e!==o&&o()},s.onerror=function(a){r._friendlyFileLoadError(0,s.src),"function"==typeof i&&i!==o&&i(a)},0!==t.indexOf("data:image/")&&(s.crossOrigin="Anonymous"),s.src=t,s},r.prototype.imageElement=function(t,e,i,s,o,a,h,u,f){function y(p,b){return p>0&&p<b?p:b}function x(p,b,_,C,O){return O===r.prototype.CORNER?{x:p,y:b,w:_,h:C}:O===r.prototype.CORNERS?{x:p,y:b,w:_-p,h:C-b}:O===r.prototype.RADIUS?{x:p-_,y:b-C,w:2*_,h:2*C}:O===r.prototype.CENTER?{x:p-.5*_,y:b-.5*C,w:_,h:C}:void 0}if(arguments.length<=5)a=e||0,h=i||0,e=0,i=0,u=s||t.width,f=o||t.height,s=t.width,o=t.height;else{if(9!==arguments.length)throw"Wrong number of arguments to imageElement()";e=e||0,i=i||0,s=y(s,t.width),o=y(o,t.height),a=a||0,h=h||0,u=u||t.width,f=f||t.height}var c=x(a,h,u,f,this._renderer._imageMode);if(this._renderer._tint){var w=this._tempCanvas.getContext("2d");this._tempCanvas.width<c.w||this._tempCanvas.height<c.h?(this._tempCanvas.width=Math.max(this._tempCanvas.width,c.w),this._tempCanvas.height=Math.max(this._tempCanvas.height,c.h)):w.clearRect(0,0,c.w,c.h),w.drawImage(t,e,i,s,o,0,0,c.w,c.h),this._renderer.image({canvas:this._tempCanvas},0,0,c.w,c.h,c.x,c.y,c.w,c.h)}else this._renderer.image({elt:t},e,i,s,o,c.x,c.y,c.w,c.h)},M("allSprites",function(){return new r.prototype.Group}),r.prototype._mouseButtonIsPressed=function(t){return this.mouseIsPressed&&this.mouseButton===t||this.touchIsDown&&t===this.LEFT},r.prototype.mouseDidMove=function(){return this.pmouseX!==this.mouseX||this.pmouseY!==this.mouseY},r.prototype.mouseIsOver=function(t){return!!t&&(t.collider||t.setDefaultCollider(),e=this.camera.active?this.createVector(this.camera.mouseX,this.camera.mouseY):this.createVector(this.mouseX,this.mouseY),t.collider.overlap(new window.p5.PointCollider(e)));var e},r.prototype.mousePressedOver=function(t){return(this.mouseIsPressed||this.touchIsDown)&&this.mouseIsOver(t)};var q="rgba(0,0,0,0)";function V(t,e,i,s,o){var a=function(t){return function(i){var s=t[i];if("function"!=typeof s)throw new Error('"'+i+'" is not a p5 method');return s.bind(t)}}(t),h=a("createVector"),u=a("color"),f=a("print"),y=a("push"),x=a("pop"),c=a("colorMode"),w=a("tint"),p=a("alphaTint"),b=a("lerpColor"),_=a("noStroke"),C=a("rectMode"),O=a("ellipseMode"),Y=a("imageMode"),g=a("translate"),rt=a("scale"),J=a("rotate"),U=a("stroke"),Z=a("strokeWeight"),N=a("line"),v=a("noFill"),$=a("fill"),st=a("textAlign"),At=a("textSize"),Tt=a("text"),Pt=a("rect"),ot=a("cos"),nt=a("sin"),yt=a("atan2"),Et=t.quadTree,at=t.camera,Dt=r.prototype.RGB,ht=r.prototype.CENTER,Mt=r.prototype.LEFT,Ot=r.prototype.BOTTOM;this.position=h(e,i),this.previousPosition=h(e,i),this.newPosition=h(e,i),this.deltaX=0,this.deltaY=0,this.velocity=h(0,0),this.maxSpeed=-1,this.friction=0,this.collider=void 0,this.touching={},this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1,this.mass=1,this.immovable=!1,this.restitution=1,Object.defineProperty(this,"rotation",{enumerable:!0,get:function(){return this._rotation},set:function(n){this._rotation=n,this.rotateToDirection&&this.setSpeed(this.getSpeed(),n)}}),this._rotation=0,this.rotationSpeed=0,this.rotateToDirection=!1,this.depth=0,this.scale=1;var lt=1,ut=1;this.visible=!0,this.mouseActive=!1,this.mouseIsOver=!1,this.mouseIsPressed=!1,this.alpha=1,this._internalWidth=s,this._internalHeight=o,this._horizontalStretch=1,this._verticalStretch=1,Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return void 0===this._internalWidth?100:this.animation&&t._fixedSpriteAnimationFrameSizes?this._internalWidth*this._horizontalStretch:this._internalWidth},set:function(n){this.animation&&t._fixedSpriteAnimationFrameSizes?this._horizontalStretch=n/this._internalWidth:this._internalWidth=n}}),this.width=void 0===s?100:s,Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return void 0===this._internalHeight?100:this.animation&&t._fixedSpriteAnimationFrameSizes?this._internalHeight*this._verticalStretch:this._internalHeight},set:function(n){this.animation&&t._fixedSpriteAnimationFrameSizes?this._verticalStretch=n/this._internalHeight:this._internalHeight=n}}),this.height=void 0===o?100:o,this.originalWidth=this._internalWidth,this.originalHeight=this._internalHeight,this.getScaledWidth=function(){return this.width*this.scale},this.getScaledHeight=function(){return this.height*this.scale},this.removed=!1,this.life=-1,this.debug=!1,this.shapeColor=u(127,127,127),this.groups=[];var D={},P="";this.animation=void 0,this._sweptCollider=void 0,Object.defineProperty(this,"x",{enumerable:!0,get:function(){return this.position.x},set:function(n){this.position.x=n}}),Object.defineProperty(this,"y",{enumerable:!0,get:function(){return this.position.y},set:function(n){this.position.y=n}}),Object.defineProperty(this,"velocityX",{enumerable:!0,get:function(){return this.velocity.x},set:function(n){this.velocity.x=n}}),Object.defineProperty(this,"velocityY",{enumerable:!0,get:function(){return this.velocity.y},set:function(n){this.velocity.y=n}}),Object.defineProperty(this,"lifetime",{enumerable:!0,get:function(){return this.life},set:function(n){this.life=n}}),Object.defineProperty(this,"bounciness",{enumerable:!0,get:function(){return this.restitution},set:function(n){this.restitution=n}}),Object.defineProperty(this,"frameDelay",{enumerable:!0,get:function(){return this.animation&&this.animation.frameDelay},set:function(n){this.animation&&(this.animation.frameDelay=n)}}),this._getBroadPhaseCollider=function(){return this.velocity.magSq()>0?this._sweptCollider:this.collider},this._doSweptCollidersOverlap=function(n){var l=this._getBroadPhaseCollider().collide(n._getBroadPhaseCollider());return 0!==l.x||0!==l.y},this._syncAnimationSizes=function(n,l){t._fixedSpriteAnimationFrameSizes||(n[l].frameChanged||void 0===this.width||void 0===this.height)&&(this._internalWidth=n[l].getWidth()*R(this._getScaleX()),this._internalHeight=n[l].getHeight()*R(this._getScaleY()))},this.update=function(){this.removed||(this._sweptCollider&&this.velocity.magSq()>0&&this._sweptCollider.updateSweptColliderFromSprite(this),this.previousPosition=this.newPosition!==this.position?h(this.newPosition.x,this.newPosition.y):h(this.position.x,this.position.y),this.velocity.x*=1-this.friction,this.velocity.y*=1-this.friction,-1!==this.maxSpeed&&this.limitSpeed(this.maxSpeed),this.rotateToDirection&&this.velocity.mag()>0&&(this._rotation=this.getDirection()),this.rotation+=this.rotationSpeed,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.newPosition=h(this.position.x,this.position.y),this.deltaX=this.position.x-this.previousPosition.x,this.deltaY=this.position.y-this.previousPosition.y,D[P]&&(D[P].update(),this._syncAnimationSizes(D,P)),this.collider&&this.collider.updateFromSprite(this),this.mouseActive?(this.collider||this.setDefaultCollider(),this.mouseUpdate()):("function"==typeof this.onMouseOver||"function"==typeof this.onMouseOut||"function"==typeof this.onMousePressed||"function"==typeof this.onMouseReleased)&&(this.mouseActive=!0,this.collider||this.setDefaultCollider(),this.mouseUpdate()),this.life>0&&this.life--,0===this.life&&this.remove())},this.setDefaultCollider=function(){D[P]&&1===D[P].getWidth()&&1===D[P].getHeight()||this.setCollider("rectangle")},this.mouseUpdate=function(){var d,n=this.mouseIsOver,l=this.mouseIsPressed;this.mouseIsOver=!1,this.mouseIsPressed=!1,this.collider&&(d=at.active?h(at.mouseX,at.mouseY):h(t.mouseX,t.mouseY),this.mouseIsOver=this.collider.overlap(new r.PointCollider(d)),this.mouseIsOver&&(t.mouseIsPressed||t.touchIsDown)&&(this.mouseIsPressed=!0),!n&&this.mouseIsOver&&void 0!==this.onMouseOver&&("function"==typeof this.onMouseOver?this.onMouseOver.call(this,this):f("Warning: onMouseOver should be a function")),n&&!this.mouseIsOver&&void 0!==this.onMouseOut&&("function"==typeof this.onMouseOut?this.onMouseOut.call(this,this):f("Warning: onMouseOut should be a function")),!l&&this.mouseIsPressed&&void 0!==this.onMousePressed&&("function"==typeof this.onMousePressed?this.onMousePressed.call(this,this):f("Warning: onMousePressed should be a function")),l&&!t.mouseIsPressed&&!this.mouseIsPressed&&void 0!==this.onMouseReleased&&("function"==typeof this.onMouseReleased?this.onMouseReleased.call(this,this):f("Warning: onMouseReleased should be a function")))},this.setCollider=function(n,l,d,m,S,E){var A=n?n.toLowerCase():"";if("rectangle"===A&&(A="obb"),"point"!==A&&"circle"!==A&&"obb"!==A&&"aabb"!==A)throw new TypeError('setCollider expects the first argument to be one of "point", "circle", "rectangle", "aabb" or "obb"');if("point"===A&&1!==arguments.length&&3!==arguments.length)throw new TypeError('Usage: setCollider("'+n+'"[, offsetX, offsetY])');if("circle"===A&&1!==arguments.length&&3!==arguments.length&&4!==arguments.length)throw new TypeError('Usage: setCollider("'+n+'"[, offsetX, offsetY[, radius]])');if("aabb"===A&&1!==arguments.length&&3!==arguments.length&&5!==arguments.length)throw new TypeError('Usage: setCollider("'+n+'"[, offsetX, offsetY[, width, height]])');if("obb"===A&&1!==arguments.length&&3!==arguments.length&&5!==arguments.length&&6!==arguments.length)throw new TypeError('Usage: setCollider("'+n+'"[, offsetX, offsetY[, width, height[, rotation]]])');var X=h(l,d);"point"===A?this.collider=r.PointCollider.createFromSprite(this,X):"circle"===A?this.collider=r.CircleCollider.createFromSprite(this,X,m):"aabb"===A?this.collider=r.AxisAlignedBoundingBoxCollider.createFromSprite(this,X,m,S):"obb"===A&&(this.collider=r.OrientedBoundingBoxCollider.createFromSprite(this,X,m,S,F(E))),this._sweptCollider=new r.OrientedBoundingBoxCollider},this.mirrorX=function(n){if(1!==n&&-1!==n)return lt;lt=n},this.mirrorY=function(n){if(1!==n&&-1!==n)return ut;ut=n},this._getScaleX=function(){return t._fixedSpriteAnimationFrameSizes?this.scale*this._horizontalStretch:this.scale},this._getScaleY=function(){return t._fixedSpriteAnimationFrameSizes?this.scale*this._verticalStretch:this.scale},this.display=function(){this.visible&&!this.removed&&(y(),c(Dt),_(),C(ht),O(ht),Y(ht),g(this.position.x,this.position.y),J(t._angleMode===t.RADIANS?F(this.rotation):this.rotation),rt(this._getScaleX()*lt,this._getScaleY()*ut),this.draw(),x(),this.debug&&(y(),U(0,255,0),Z(1),N(this.position.x-10,this.position.y,this.position.x+10,this.position.y),N(this.position.x,this.position.y-10,this.position.x,this.position.y+10),v(),_(),$(0,255,0),st(Mt,Ot),At(16),Tt(this.depth+"",this.position.x+4,this.position.y-2),v(),U(0,255,0),void 0===this.collider&&this.setDefaultCollider(),this.collider&&this.collider.draw(t),x()))},this.draw=function(){if(""!==P&&D)D[P]&&(this.tint&&(y(),w(this.tint)),this.alpha<1&&(y(),p(this.alpha)),D[P].draw(0,0,0),this.alpha<1&&x(),this.tint&&x());else{var n=this.shapeColor;this.tint&&(n=b(u(n),u(this.tint),.5)),_(),$(n),Pt(0,0,this._internalWidth,this._internalHeight)}},this.remove=function(){for(this.removed=!0,Et.removeObject(this);this.groups.length>0;)this.groups[0].remove(this)},this.destroy=this.remove,this.setVelocity=function(n,l){this.velocity.x=n,this.velocity.y=l},this.getSpeed=function(){return this.velocity.mag()},this.getDirection=function(){var n=yt(this.velocity.y,this.velocity.x);return isNaN(n)&&(n=0),t._angleMode===t.RADIANS&&(n=ft(n)),n},this.addToGroup=function(n){n instanceof Array?n.add(this):f("addToGroup error: "+n+" is not a group")},this.limitSpeed=function(n){var l=this.getSpeed();if(R(l)>n){var d=n/R(l);this.velocity.x*=d,this.velocity.y*=d}},this.setSpeed=function(n,l){var d;d=void 0===l?0!==this.velocity.x||0!==this.velocity.y?t.atan2(this.velocity.y,this.velocity.x):t._angleMode===t.RADIANS?F(this._rotation):this._rotation:t._angleMode===t.RADIANS?F(l):l,this.velocity.x=ot(d)*n,this.velocity.y=nt(d)*n},this.setSpeedAndDirection=this.setSpeed,this.setFrame=function(n){this.animation&&this.animation.changeFrame(n)},this.nextFrame=function(){this.animation&&this.animation.nextFrame()},this.previousFrame=function(){this.animation&&this.animation.previousFrame()},this.pause=function(){this.animation&&this.animation.stop()},this.play=function(){!this.animation||(!this.animation.looping&&!this.animation.playing&&this.animation.getFrame()===this.animation.images.length-1&&this.animation.rewind(),this.animation.play())},this.frameDidChange=function(){return!!this.animation&&this.animation.frameChanged},this.pointTo=function(n,l){var d=l-this.position.y,m=n-this.position.x;if(!(isNaN(m)||isNaN(d)||0===m&&0===d)){var S=Math.atan2(d,m);this.rotation=360*S/(2*Math.PI)}},this.addSpeed=function(n,l){var d;d=t._angleMode===t.RADIANS?F(l):l,this.velocity.x+=ot(d)*n,this.velocity.y+=nt(d)*n},this.attractionPoint=function(n,l,d){var m=yt(d-this.position.y,l-this.position.x);this.velocity.x+=ot(m)*n,this.velocity.y+=nt(m)*n},this.addImage=function(){if("string"==typeof arguments[0]&&arguments[1]instanceof r.Image)this.addAnimation(arguments[0],arguments[1]);else{if(!(arguments[0]instanceof r.Image))throw"addImage error: allowed usages are <image> or <label>, <image>";this.addAnimation("normal",arguments[0])}},this.addAnimation=function(n){var l;if("string"!=typeof n)return f("Sprite.addAnimation error: the first argument must be a label (String)"),-1;if(arguments.length<2)return f("addAnimation error: you must specify a label and n frame images"),-1;if(arguments[1]instanceof tt){var d=arguments[1],m=d.clone();return D[n]=m,""===P&&(P=n,this.animation=m),m.isSpriteAnimation=!0,this._internalWidth=m.getWidth()*R(this._getScaleX()),this._internalHeight=m.getHeight()*R(this._getScaleY()),m}for(var S=[],E=1;E<arguments.length;E++)S.push(arguments[E]);return l=it(t.Animation,S),D[n]=l,""===P&&(P=n,this.animation=l),l.isSpriteAnimation=!0,this._internalWidth=l.getWidth()*R(this._getScaleX()),this._internalHeight=l.getHeight()*R(this._getScaleY()),l},this.changeImage=function(n){this.changeAnimation(n)},this.getAnimationLabel=function(){return P},this.changeAnimation=function(n){D[n]?(P=n,this.animation=D[n]):f("changeAnimation error: no animation labeled "+n)},this.setAnimation=function(n){if(n!==this.getAnimationLabel()){var l=t._predefinedSpriteAnimations&&t._predefinedSpriteAnimations[n];if(void 0===l)throw new Error('Unable to find an animation named "'+n+'".  Please make sure the animation exists.');this.addAnimation(n,l),this.changeAnimation(n),t._pauseSpriteAnimationsByDefault&&this.pause()}},this.overlapPixel=function(n,l){var d=h(n,l),m=this.animation.getFrameImage();return d.x-=this.position.x-m.width/2,d.y-=this.position.y-m.height/2,!(d.x<0||d.x>m.width||d.y<0||d.y>m.height||(0===this.rotation&&1===this.scale?255!==m.get(d.x,d.y)[3]:(f("Error: overlapPixel doesn't work with scaled or rotated sprites yet"),1)))},this.overlapPoint=function(n,l){if(this.collider||this.setDefaultCollider(),this.collider){var d=new r.PointCollider(new r.Vector(n,l));return this.collider.overlap(d)}return!1},this.overlap=function(n,l){return this._collideWith("overlap",n,l)},this.isTouching=this.overlap,this.collide=function(n,l){return this._collideWith("collide",n,l)},this.displace=function(n,l){return this._collideWith("displace",n,l)},this.bounce=function(n,l){return this._collideWith("bounce",n,l)},this.bounceOff=function(n,l){return this._collideWith("bounceOff",n,l)},this._collideWith=function(n,l,d){if(this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1,this.removed)return!1;var m=[];if(l instanceof V)m.push(l);else{if(!(l instanceof Array))throw"Error: overlap can only be checked between sprites or groups";void 0!==t.quadTree&&t.quadTree.active&&(m=t.quadTree.retrieveFromGroup(this,l)),0===m.length&&(m=l)}for(var S=!1,E=0;E<m.length;E++)S=this._collideWithOne(n,m[E],d)||S;return S},this._collideWithOne=function(n,l,d){if(l===this||l.removed||(void 0===this.collider&&this.setDefaultCollider(),void 0===l.collider&&l.setDefaultCollider(),!this.collider||!l.collider))return!1;var m=this._findDisplacement(l);if(0===m.x&&0===m.y)return!1;m.x>0&&(this.touching.left=!0),m.x<0&&(this.touching.right=!0),m.y<0&&(this.touching.bottom=!0),m.y>0&&(this.touching.top=!0),"displace"!==n||l.immovable?("collide"===n||"bounce"===n||"bounceOff"===n)&&!this.immovable&&(this.position.add(m),this.previousPosition=h(this.position.x,this.position.y),this.newPosition=h(this.position.x,this.position.y),this.collider.updateFromSprite(this)):l.position.sub(m);var S=n,E=this.immovable,A=l.immovable,X=l.restitution;if("collide"===S?(n="bounce",l.immovable=!0,l.restitution=0):"bounceOff"===S&&(n="bounce",l.immovable=!0),"bounce"===n){var j=r.Vector.project(this.velocity,m),W=r.Vector.project(l.velocity,m),H=this.mass,L=l.mass;this.immovable?(H=1,L=0):l.immovable&&(H=0,L=1);var vt=H+L,_t=this.restitution*l.restitution,St=r.Vector.add(r.Vector.mult(j,H),r.Vector.mult(W,L)),Ft=r.Vector.sub(W,j).mult(L*_t).add(St).div(vt),Rt=r.Vector.sub(j,W).mult(H*_t).add(St).div(vt);this.velocity.sub(j).add(Ft),l.velocity.sub(W).add(Rt)}return n=S,this.immovable=E,l.immovable=A,l.restitution=X,"function"==typeof d&&"isTouching"!==n&&d.call(this,this,l),!0},this._findDisplacement=function(n){if(this._doSweptCollidersOverlap(n)){var l=Math.max(this.collider._getMinRadius(),n.collider._getMinRadius()),d=r.Vector.sub(this.velocity,n.velocity).mag(),m=Math.max(.015,l/d);if(m<1){var S=this.position.copy(),E=n.position.copy();this.position.set(this.previousPosition),n.position.set(n.previousPosition);for(var A=r.Vector.sub(S,this.previousPosition).mult(m),X=r.Vector.sub(E,n.previousPosition).mult(m),j=m;j<1;j+=m){this.position.add(A),n.position.add(X),this.collider.updateFromSprite(this),n.collider.updateFromSprite(n);var W=this.collider.collide(n.collider);if(0!==W.x||0!==W.y)return this.immovable&&this.position.set(S),n.immovable&&n.position.set(E),W}this.position.set(S),n.position.set(E)}}return this.collider.updateFromSprite(this),n.collider.updateFromSprite(n),this.collider.collide(n.collider)}}function dt(t,e,i,s){this.position=t.createVector(e,i),Object.defineProperty(this,"x",{enumerable:!0,get:function(){return this.position.x},set:function(o){this.position.x=o}}),Object.defineProperty(this,"y",{enumerable:!0,get:function(){return this.position.y},set:function(o){this.position.y=o}}),this.zoom=s,this.mouseX=t.mouseX,this.mouseY=t.mouseY,this.active=!1,this.isActive=function(){return this.active},this.on=function(){this.active||(mt.call(t),this.active=!0)},this.off=function(){this.active&&(gt.call(t),this.active=!1)}}function mt(){var t=this,e=t.camera;!e.init&&0===e.position.x&&0===e.position.y&&(e.position.x=t.width/2,e.position.y=t.height/2,e.init=!0),e.mouseX=t.mouseX+e.position.x-t.width/2,e.mouseY=t.mouseY+e.position.y-t.height/2,e.active||(e.active=!0,t.push(),t.scale(e.zoom),t.translate(t.width/2/e.zoom-e.position.x,t.height/2/e.zoom-e.position.y))}function gt(){var t=this;t.camera.active&&(t.pop(),t.camera.active=!1)}function tt(t){var i,e=Array.prototype.slice.call(arguments,1),s=r.prototype.CENTER;this.images=[];var o=0,a=0,h=-1;if(this.offX=0,this.offY=0,this.frameDelay=4,this.playing=!0,this.visible=!0,this.looping=!0,this.frameChanged=!1,this.imageCollider=!1,2===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]){var u=e[0],f=e[1],y=u.substring(u.length-4,u.length);".png"!==y&&(t.print("Animation error: you need to use .png files (filename "+u+")"),u=-1);var x=f.substring(f.length-4,f.length);if(".png"!==x&&(t.print("Animation error: you need to use .png files (filename "+f+")"),f=-1),-1!==u&&-1!==f){var c=0,w=0;for(i=u.length-5;i>=0;i--)u.charAt(i)>="0"&&u.charAt(i)<="9"&&c++;for(i=f.length-5;i>=0;i--)f.charAt(i)>="0"&&f.charAt(i)<="9"&&w++;var Y,p=u.substring(0,u.length-(4+c)),b=f.substring(0,f.length-(4+w)),_=parseInt(u.substring(u.length-(4+c),u.length-4),10),C=parseInt(f.substring(f.length-(4+w),f.length-4),10);if(C<_){var O=C;C=_,_=O}if(p!==b)this.images.push(t.loadImage(u)),this.images.push(t.loadImage(f));else if(c===w)for(i=_;i<=C;i++)Y=p+t.nf(i,c)+".png",this.images.push(t.loadImage(Y));else for(i=_;i<=C;i++)this.images.push(t.loadImage(Y=p+i+".png"))}}else if(1===e.length&&e[0]instanceof et)this.spriteSheet=e[0],this.images=this.spriteSheet.frames.map(function(g){return g.spriteSourceSize&&g.sourceSize?Object.assign(g.frame,{width:g.frame.w,height:g.frame.h,sourceX:g.spriteSourceSize.x,sourceY:g.spriteSourceSize.y,sourceW:g.sourceSize.w,sourceH:g.sourceSize.h}):g.frame});else if(0!==e.length)for(i=0;i<e.length;i++)this.images.push(e[i]instanceof r.Image?e[i]:t.loadImage(e[i]));this.clone=function(){var g=new tt(t);return g.images=[],this.spriteSheet&&(g.spriteSheet=this.spriteSheet.clone()),g.images=this.images.slice(),g.offX=this.offX,g.offY=this.offY,g.frameDelay=this.frameDelay,g.playing=this.playing,g.looping=this.looping,g},this.draw=function(g,rt,J){if(this.xpos=g,this.ypos=rt,this.rotation=J||0,this.visible){this.isSpriteAnimation||this.update(),t.push(),t.imageMode(s);var U=this.xpos,Z=this.ypos,N=this.images[o],v=this.spriteSheet&&N;v&&(U+=(v.sourceX||0)-((v.sourceW||v.width)-v.width)/2,Z+=(v.sourceY||0)-((v.sourceH||v.height)-v.height)/2),t.translate(U,Z),t.rotate(t._angleMode===t.RADIANS?F(this.rotation):this.rotation),v?this.spriteSheet.image instanceof Image?t.imageElement(this.spriteSheet.image,v.x,v.y,v.width,v.height,this.offX,this.offY,v.width,v.height):t.image(this.spriteSheet.image,v.x,v.y,v.width,v.height,this.offX,this.offY,v.width,v.height):N?N instanceof Image?t.imageElement(N,this.offX,this.offY):t.image(N,this.offX,this.offY):t.print("Warning undefined frame "+o),t.pop()}},this.update=function(){a++;var g=o;this.frameChanged=!1,1===this.images.length&&(this.playing=!1,o=0),this.playing&&a%this.frameDelay==0&&(h>o&&-1!==h?o++:h<o&&-1!==h?o--:h===o&&-1!==h?this.playing=!1:this.looping?o>=this.images.length-1?o=0:o++:o<this.images.length-1?o++:this.playing=!1),g!==o&&(this.frameChanged=!0)},this.play=function(){this.playing=!0,h=-1},this.stop=function(){this.playing=!1},this.rewind=function(){o=0},this.changeFrame=function(g){o=g<this.images.length?g:this.images.length-1,h=-1},this.nextFrame=function(){o<this.images.length-1?o+=1:this.looping&&(o=0),h=-1,this.playing=!1},this.previousFrame=function(){o>0?o-=1:this.looping&&(o=this.images.length-1),h=-1,this.playing=!1},this.goToFrame=function(g){g<0||g>=this.images.length||(h=g)!==o&&(this.playing=!0)},this.getFrame=function(){return o},this.getLastFrame=function(){return this.images.length-1},this.getFrameImage=function(){return this.images[o]},this.getImageAt=function(g){return this.images[g]},this.getWidth=function(){return this.images[o]?this.images[o].sourceW||this.images[o].width:1},this.getHeight=function(){return this.images[o]?this.images[o].sourceH||this.images[o].height:1}}function et(t){var e=Array.prototype.slice.call(arguments,1);this.image=null,this.frames=[],this.frame_width=0,this.frame_height=0,this.num_frames=0,this._generateSheetFrames=function(){for(var h=0,u=0,f=0;f<this.num_frames;f++)this.frames.push({name:f,frame:{x:h,y:u,width:this.frame_width,height:this.frame_height}}),(h+=this.frame_width)>=this.image.width&&(h=0,(u+=this.frame_height)>=this.image.height&&(u=0))};var o,i=2===e.length||3===e.length,s=4===e.length||5===e.length;if(i&&Array.isArray(e[1])?(this.frames=e[1],this.num_frames=this.frames.length):s&&"number"==typeof e[1]&&"number"==typeof e[2]&&"number"==typeof e[3]&&(this.frame_width=e[1],this.frame_height=e[2],this.num_frames=e[3]),e[0]instanceof r.Image||e[0]instanceof Image)this.image=e[0],s&&this._generateSheetFrames();else if(i)e[2]?("function"==typeof e[2]&&(o=e[2]),this.image=t.loadImageElement(e[0],function(h){if(o)return o(h)},function(){if(o)return o(null)})):this.image=t.loadImage(e[0]);else if(s){var a=this._generateSheetFrames.bind(this);e[4]?("function"==typeof e[4]&&(o=e[4]),this.image=t.loadImageElement(e[0],function(h){if(a(h),o)return o(h)},function(){if(o)return o(null)})):this.image=t.loadImage(e[0],a)}this.drawFrame=function(h,u,f,y,x){var c;if("number"==typeof h)c=this.frames[h];else for(var w=0;w<this.frames.length;w++)if(this.frames[w].name===h){c=this.frames[w];break}var p=c.frame.width||c.frame.w,b=c.frame.height||c.frame.h,_=y||p,C=x||b;c.spriteSourceSize&&c.sourceSize&&(y?(u+=c.spriteSourceSize.x*_/c.sourceSize.w,_=y*(p/c.sourceSize.w)):u+=c.spriteSourceSize.x,x?(f+=c.spriteSourceSize.y*C/c.sourceSize.h,C=x*(b/c.sourceSize.h)):f+=c.spriteSourceSize.y),this.image instanceof Image?t.imageElement(this.image,c.frame.x,c.frame.y,c.frame.width,c.frame.height,u,f,_,C):t.image(this.image,c.frame.x,c.frame.y,c.frame.width,c.frame.height,u,f,_,C)},this.clone=function(){for(var h=new et(t),u=0;u<this.frames.length;u++){var f=this.frames[u].frame;h.frames.push({name:f.name,frame:{x:f.x,y:f.y,width:f.width,height:f.height}})}return h.image=this.image,h.frame_width=this.frame_width,h.frame_height=this.frame_height,h.num_frames=this.num_frames,h}}function it(t,e){function i(){return t.apply(this,e)}return i.prototype=t.prototype,new i}function T(t,e,i,s){this.active=!0,this.max_objects=e||10,this.max_levels=i||4,this.level=s||0,this.bounds=t,this.objects=[],this.object_refs=[],this.nodes=[]}function pt(t){return 0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}r.Renderer2D.prototype.regularPolygon=function(t,e,i,s,o){var a=this.drawingContext,h=this._doFill,u=this._doStroke;if(h&&!u){if(a.fillStyle===q)return this}else if(!h&&u&&a.strokeStyle===q)return this;if(!(i<3)){a.beginPath(),a.moveTo(t+s*Math.cos(o),e+s*Math.sin(o));for(var f=1;f<i;f++){var y=o+2*f*Math.PI/i;a.lineTo(t+s*Math.cos(y),e+s*Math.sin(y))}a.closePath(),h&&a.fill(),u&&a.stroke()}},r.prototype.regularPolygon=function(t,e,i,s,o){if(!this._renderer._doStroke&&!this._renderer._doFill)return this;for(var a=new Array(arguments.length),h=0;h<a.length;++h)a[h]=arguments[h];return void 0===o?(o=-Math.PI/2,i%2==0&&(o+=Math.PI/i)):this._angleMode===this.DEGREES&&(o=this.radians(o)),this._renderer.isP3D||(this._validateParameters("regularPolygon",a,[["Number","Number","Number","Number"],["Number","Number","Number","Number","Number"]]),this._renderer.regularPolygon(a[0],a[1],a[2],a[3],o)),this},r.Renderer2D.prototype.shape=function(){var t=this.drawingContext,e=this._doFill,i=this._doStroke;if(e&&!i){if(t.fillStyle===q)return this}else if(!e&&i&&t.strokeStyle===q)return this;var s=arguments.length/2;if(!(s<1)){t.beginPath(),t.moveTo(arguments[0],arguments[1]);for(var o=1;o<s;o++)t.lineTo(arguments[2*o],arguments[2*o+1]);t.closePath(),e&&t.fill(),i&&t.stroke()}},r.prototype.shape=function(){return this._renderer._doStroke||this._renderer._doFill?(this._renderer.isP3D||this._renderer.shape.apply(this._renderer,arguments),this):this},r.prototype.rgb=function(t,e,i,s){return s||(s=1),this.color(t,e,i,s*=255)},r.prototype.createGroup=function(){return new this.Group},M("World",function(){var t={pInst:this};function e(i){Object.defineProperty(t,i,{enumerable:!0,get:function(){return this.pInst[i]}})}return e("width"),e("height"),e("mouseX"),e("mouseY"),e("allSprites"),e("frameCount"),Object.defineProperty(t,"frameRate",{enumerable:!0,get:function(){return this.pInst.frameRate()},set:function(i){this.pInst.frameRate(i)}}),Object.defineProperty(t,"seconds",{enumerable:!0,get:function(){var s=(new Date).getTime();return Math.round((s-this.pInst._startTime)/1e3)}}),t}),r.prototype.spriteUpdate=!0,r.prototype.createSprite=function(t,e,i,s){var o=new V(this,t,e,i,s);return o.depth=this.allSprites.maxDepth()+1,this.allSprites.add(o),o},r.prototype.removeSprite=function(t){t.remove()},r.prototype.updateSprites=function(t){if(!1===t&&(this.spriteUpdate=!1),!0===t&&(this.spriteUpdate=!0),this.spriteUpdate)for(var e=0;e<this.allSprites.size();e++)this.allSprites.get(e).update()},r.prototype.getSprites=function(){if(0===arguments.length)return this.allSprites.toArray();for(var t=[],e=0;e<arguments.length;e++)for(var i=0;i<this.allSprites.size();i++)this.allSprites.get(i).isTagged(arguments[e])&&t.push(this.allSprites.get(i));return t},r.prototype.drawSprites=function(t){if("function"!=typeof(t=t||this.allSprites).draw)throw"Error: with drawSprites you can only draw all sprites or a group";t.draw()},r.prototype.drawSprite=function(t){t&&t.display()},r.prototype.loadAnimation=function(){return it(this.Animation,arguments)},r.prototype.loadSpriteSheet=function(){return it(this.SpriteSheet,arguments)},r.prototype.animation=function(t,e,i){t.draw(e,i)},M("_p5play",function(){return{keyStates:{},mouseStates:{}}}),r.prototype.keyWentDown=function(t){return this._isKeyInState(t,1)},r.prototype.keyWentUp=function(t){return this._isKeyInState(t,3)},r.prototype.keyDown=function(t){return this._isKeyInState(t,2)},r.prototype._isKeyInState=function(t,e){var i,s=this._p5play.keyStates;return void 0===s[i="string"==typeof t?this._keyCodeFromAlias(t):t]&&(s[i]=this.keyIsDown(i)?2:0),s[i]===e},r.prototype.mouseDown=function(t){return this._isMouseButtonInState(t,2)},r.prototype.mouseUp=function(t){return this._isMouseButtonInState(t,0)},r.prototype.mouseWentUp=function(t){return this._isMouseButtonInState(t,3)},r.prototype.mouseWentDown=function(t){return this._isMouseButtonInState(t,1)},r.prototype._clickKeyFromString=function(t){return this.CLICK_KEY[t]?this.CLICK_KEY[t]:t},r.prototype.CLICK_KEY={leftButton:r.prototype.LEFT,rightButton:r.prototype.RIGHT,centerButton:r.prototype.CENTER},r.prototype._isMouseButtonInState=function(t,e){var i=this._p5play.mouseStates;return void 0===(t=this._clickKeyFromString(t))&&(t=this.LEFT),void 0===i[t]&&(i[t]=this._mouseButtonIsPressed(t)?2:0),i[t]===e},r.prototype.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32," ":32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,LEFT:37,UP_ARROW:38,UP:38,RIGHT_ARROW:39,RIGHT:39,DOWN_ARROW:40,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0NUMPAD":96,"1NUMPAD":97,"2NUMPAD":98,"3NUMPAD":99,"4NUMPAD":100,"5NUMPAD":101,"6NUMPAD":102,"7NUMPAD":103,"8NUMPAD":104,"9NUMPAD":105,MULTIPLY:106,PLUS:107,MINUS:109,DOT:110,SLASH1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUAL:187,COMMA:188,SLASH:191,BACKSLASH:220},r.prototype.KEY_DEPRECATIONS={MINUT:"MINUS",COMA:"COMMA"},r.prototype._keyCodeFromAlias=function(t){return t=t.toUpperCase(),this.KEY_DEPRECATIONS[t]&&(this._warn('Key literal "'+t+'" is deprecated and may be removed in a future version of p5.play. Please use "'+this.KEY_DEPRECATIONS[t]+'" instead.'),t=this.KEY_DEPRECATIONS[t]),this.KEY[t]},r.prototype.readPresses=function(){var t=this._p5play.keyStates,e=this._p5play.mouseStates;for(var i in t)t[i]=this.keyIsDown(i)?0===t[i]?1:2:2===t[i]?3:0;for(var s in e)e[s]=this._mouseButtonIsPressed(s)?0===e[s]?1:2:2===e[s]?3:0},r.prototype.useQuadTree=function(t){return void 0!==this.quadTree&&(void 0===t?this.quadTree.active:void(this.quadTree.active=!!t))},M("quadTree",function(){var t=new T({x:0,y:0,width:0,height:0},4);return t.active=!1,t}),M("Sprite",K(V)),M("Camera",K(dt)),r.prototype.Group=function(){var t=[];function e(s,o){return null===s||null===o?null===s&&null===o:"string"==typeof s||"object"!=typeof s?s===o:s.equals instanceof Function?s.equals(o):s===o}function i(s,o,a){for(var h=!1,u=0;u<this.size();u++)h=this.get(u)._collideWith(s,o,a)||h;return h}return t.get=function(s){return t[s]},t.contains=function(s){return this.indexOf(s)>-1},t.indexOf=function(s){for(var o=0,a=t.length;o<a;++o)if(e(s,t[o]))return o;return-1},t.add=function(s){if(!(s instanceof V))throw"Error: you can only add sprites to a group";-1===this.indexOf(s)&&(t.push(s),s.groups.push(this))},t.size=function(){return t.length},t.removeSprites=function(){for(;t.length>0;)t[0].remove()},t.clear=function(){t.length=0},t.remove=function(s){if(!(s instanceof V))throw"Error: you can only remove sprites from a group";var o,a=!1;for(o=t.length-1;o>=0;o--)t[o]===s&&(t.splice(o,1),a=!0);if(a)for(o=s.groups.length-1;o>=0;o--)s.groups[o]===this&&s.groups.splice(o,1);return a},t.toArray=function(){return t.slice(0)},t.maxDepth=function(){return 0===t.length?0:t.reduce(function(s,o){return Math.max(s,o.depth)},-1/0)},t.minDepth=function(){return 0===t.length?99999:t.reduce(function(s,o){return Math.min(s,o.depth)},1/0)},t.draw=function(){this.sort(function(o,a){return o.depth-a.depth});for(var s=0;s<this.size();s++)this.get(s).display()},t.overlap=i.bind(t,"overlap"),t.isTouching=t.overlap,t.collide=i.bind(t,"collide"),t.displace=i.bind(t,"displace"),t.bounce=i.bind(t,"bounce"),t.bounceOff=i.bind(t,"bounceOff"),t.setPropertyEach=function(s,o){for(var a=0;a<this.length;a++)this[a][s]=o},t.callMethodEach=function(s){for(var o=Array.prototype.slice.call(arguments,1),a=[].concat(this),h=0;h<a.length;h++)a[h][s].apply(a[h],o)},t.setDepthEach=t.setPropertyEach.bind(t,"depth"),t.setLifetimeEach=t.setPropertyEach.bind(t,"lifetime"),t.setRotateToDirectionEach=t.setPropertyEach.bind(t,"rotateToDirection"),t.setRotationEach=t.setPropertyEach.bind(t,"rotation"),t.setRotationSpeedEach=t.setPropertyEach.bind(t,"rotationSpeed"),t.setScaleEach=t.setPropertyEach.bind(t,"scale"),t.setColorEach=t.setPropertyEach.bind(t,"shapeColor"),t.setTintEach=t.setPropertyEach.bind(t,"tint"),t.setVisibleEach=t.setPropertyEach.bind(t,"visible"),t.setVelocityXEach=t.setPropertyEach.bind(t,"velocityX"),t.setVelocityYEach=t.setPropertyEach.bind(t,"velocityY"),t.setHeightEach=t.setPropertyEach.bind(t,"height"),t.setWidthEach=t.setPropertyEach.bind(t,"width"),t.destroyEach=t.callMethodEach.bind(t,"destroy"),t.pointToEach=t.callMethodEach.bind(t,"pointTo"),t.setAnimationEach=t.callMethodEach.bind(t,"setAnimation"),t.setColliderEach=t.callMethodEach.bind(t,"setCollider"),t.setSpeedAndDirectionEach=t.callMethodEach.bind(t,"setSpeedAndDirection"),t.setVelocityEach=t.callMethodEach.bind(t,"setVelocity"),t.setMirrorXEach=t.callMethodEach.bind(t,"mirrorX"),t.setMirrorYEach=t.callMethodEach.bind(t,"mirrorY"),t},r.prototype.createEdgeSprites=function(){if(this.edges)return this.edges;var t=100,e=this.width,i=this.height;return this.leftEdge=this.createSprite(-50,i/2,t,i),this.rightEdge=this.createSprite(e+50,i/2,t,i),this.topEdge=this.createSprite(e/2,-50,e,t),this.bottomEdge=this.createSprite(e/2,i+50,e,t),this.edges=this.createGroup(),this.edges.add(this.leftEdge),this.edges.add(this.rightEdge),this.edges.add(this.topEdge),this.edges.add(this.bottomEdge),this.edges},M("Animation",K(tt)),M("SpriteSheet",K(et)),T.prototype.updateBounds=function(){for(var t=this.getAll(),e=1e4,i=1e4,s=-1e4,o=-1e4,a=0;a<t.length;a++)t[a].position.x<e&&(e=t[a].position.x),t[a].position.y<i&&(i=t[a].position.y),t[a].position.x>s&&(s=t[a].position.x),t[a].position.y>o&&(o=t[a].position.y);this.bounds={x:e,y:i,width:s,height:o}},T.prototype.split=function(){var t=this.level+1,e=Math.round(this.bounds.width/2),i=Math.round(this.bounds.height/2),s=Math.round(this.bounds.x),o=Math.round(this.bounds.y);this.nodes[0]=new T({x:s+e,y:o,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[1]=new T({x:s,y:o,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[2]=new T({x:s,y:o+i,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[3]=new T({x:s+e,y:o+i,width:e,height:i},this.max_objects,this.max_levels,t)},T.prototype.getIndex=function(t){if(t.collider){var e=t.collider.getBoundingBox(),i=-1,s=this.bounds.x+this.bounds.width/2,o=this.bounds.y+this.bounds.height/2,a=e.top<o&&e.bottom<o,h=e.top>o;return e.left<s&&e.right<s?a?i=1:h&&(i=2):e.left>s&&(a?i=0:h&&(i=3)),i}return-1},T.prototype.insert=function(t){if(-1===this.objects.indexOf(t)){var i,e=0;if(void 0!==this.nodes[0]&&-1!==(i=this.getIndex(t)))return void this.nodes[i].insert(t);if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels)for(void 0===this.nodes[0]&&this.split();e<this.objects.length;)-1!==(i=this.getIndex(this.objects[e]))?this.nodes[i].insert(this.objects.splice(e,1)[0]):e+=1}},T.prototype.retrieve=function(t){var e=this.getIndex(t),i=this.objects;if(void 0!==this.nodes[0])if(-1!==e)i=i.concat(this.nodes[e].retrieve(t));else for(var s=0;s<this.nodes.length;s+=1)i=i.concat(this.nodes[s].retrieve(t));return i},T.prototype.retrieveFromGroup=function(t,e){for(var i=[],s=this.retrieve(t),o=0;o<s.length;o++)e.contains(s[o])&&i.push(s[o]);return i},T.prototype.getAll=function(){for(var t=this.objects,e=0;e<this.nodes.length;e+=1)t=t.concat(this.nodes[e].getAll());return t},T.prototype.getObjectNode=function(t){var e;return this.nodes.length?-1===(e=this.getIndex(t))?this:this.nodes[e].getObjectNode(t)||!1:this},T.prototype.removeObject=function(t){var e=this.getObjectNode(t),i=e.objects.indexOf(t);if(-1===i)return!1;e.objects.splice(i,1)},T.prototype.clear=function(){if(this.objects=[],this.nodes.length){for(var t=0;t<this.nodes.length;t+=1)this.nodes[t].clear();this.nodes=[]}},T.prototype.cleanup=function(){var t=this.getAll();this.clear();for(var e=0;e<t.length;e++)this.insert(t[e])},r.prototype.registerMethod("pre",r.prototype.readPresses),r.prototype.registerMethod("pre",r.prototype.updateSprites),r.prototype.registerMethod("post",function(){this.quadTree.active&&(this.quadTree.updateBounds(),this.quadTree.cleanup())}),r.prototype.registerMethod("pre",mt),r.prototype.registerMethod("post",gt),r.prototype.registerPreloadMethod("loadImageElement",r.prototype),r.prototype._warn=function(t){var e=window.console;e&&("function"==typeof e.warn?e.warn(t):"function"==typeof e.log&&e.log("Warning: "+t))},r.CollisionShape=function(t,e){this._localTransform=new r.Transform2D,e&&this._localTransform.rotate(e),t&&this._localTransform.translate(t),this._parentTransform=new r.Transform2D,this._center=new r.Vector,this._offset=new r.Vector,this._rotation=0,this._scale=new r.Vector(1,1),this.getsDimensionsFromSprite=!1,Object.defineProperties(this,{center:{enumerable:!0,get:function(){return this._center.copy()}.bind(this),set:function(i){this._localTransform.translate(r.Vector.mult(this._center,-1)).translate(i),this._onTransformChanged()}.bind(this)},offset:{enumerable:!0,get:function(){return this._offset.copy()}.bind(this),set:function(i){this._localTransform.translate(r.Vector.mult(this._offset,-1)).translate(i),this._onTransformChanged()}.bind(this)},rotation:{enumerable:!0,get:function(){return this._rotation}.bind(this),set:function(i){this._localTransform.clear().scale(this._scale).rotate(i).translate(this._offset),this._onTransformChanged()}.bind(this)},scale:{enumerable:!0,get:function(){return this._scale.copy()}.bind(this),set:function(i){this._localTransform.clear().scale(i).rotate(this._rotation).translate(this._offset),this._onTransformChanged()}.bind(this)}}),this._onTransformChanged()},r.CollisionShape.prototype.updateFromSprite=function(t){this.setParentTransform(t)},r.CollisionShape.prototype.setParentTransform=function(t){if(t instanceof V)this._parentTransform.clear().scale(t._getScaleX(),t._getScaleY()).rotate(F(t.rotation)).translate(t.position);else{if(!(t instanceof r.Transform2D))throw new TypeError("Bad argument to setParentTransform: "+t);this._parentTransform=t.copy()}this._onTransformChanged()},r.CollisionShape.prototype._onTransformChanged=function(){this._rotation=this._localTransform.getRotation(),this._scale=this._localTransform.getScale(),this._offset.set(0,0).transform(this._localTransform),this._center.set(this._offset.x,this._offset.y).transform(this._parentTransform)},r.CollisionShape.prototype.collide=function(t){for(var u,f,y,e=this,i=t,s=1/0,o=null,a=r.Vector.sub(i.center,e.center),h=r.CollisionShape._getCandidateAxesForShapes(e,i),x=0;x<h.length;x++){y=(f=r.Vector.project(a,u=h[x])).mag();var p=e._getRadiusOnAxis(u)+i._getRadiusOnAxis(u)-y;if(p<=0)return new r.Vector;p<s&&(s=p,o=0===f.x&&0===f.y?u:f)}return o.copy().setMag(-s)},r.CollisionShape.prototype.overlap=function(t){var e=this.collide(t);return 0!==e.x||0!==e.y},r.CollisionShape._getCandidateAxesForShapes=function(t,e){return function(t){return t.filter(function(e,i){return!t.some(function(s,o){return i<o&&e.isParallel(s)})})}(t._getCandidateAxes(e).concat(e._getCandidateAxes(t)).map(function(s){return 0===s.x&&0===s.y?r.CollisionShape.X_AXIS:s}))},r.CollisionShape.prototype._getCandidateAxes=function(){return[]},r.CollisionShape.prototype._getRadiusOnAxis=function(){return 0},r.CollisionShape.prototype._getMinRadius=function(){return 0},r.CollisionShape.X_AXIS=new r.Vector(1,0),r.CollisionShape.Y_AXIS=new r.Vector(0,1),r.CollisionShape.WORLD_AXES=[r.CollisionShape.X_AXIS,r.CollisionShape.Y_AXIS],r.CollisionShape.prototype.getBoundingBox=function(){var t=this._getRadiusOnAxis(r.CollisionShape.X_AXIS),e=this._getRadiusOnAxis(r.CollisionShape.Y_AXIS);return{top:this.center.y-e,bottom:this.center.y+e,left:this.center.x-t,right:this.center.x+t,width:2*t,height:2*e}},r.PointCollider=function(t){r.CollisionShape.call(this,t)},r.PointCollider.prototype=Object.create(r.CollisionShape.prototype),r.PointCollider.createFromSprite=function(t,e){var i=new r.PointCollider(e);return i.setParentTransform(t),i},r.PointCollider.prototype.draw=function(t){t.push(),t.rectMode(t.CENTER),t.translate(this.center.x,this.center.y),t.noStroke(),t.fill(0,255,0),t.ellipse(0,0,2,2),t.pop()},r.CircleCollider=function(t,e){r.CollisionShape.call(this,t),this.radius=e,this._scaledRadius=0,this._computeScaledRadius()},r.CircleCollider.prototype=Object.create(r.CollisionShape.prototype),r.CircleCollider.createFromSprite=function(t,e,i){var s="number"==typeof i,o=new r.CircleCollider(e,s?i:1);return o.getsDimensionsFromSprite=!s,o.updateFromSprite(t),o},r.CircleCollider.prototype.updateFromSprite=function(t){this.getsDimensionsFromSprite&&(this.radius=t.animation?Math.max(t.animation.getWidth(),t.animation.getHeight())/2:Math.max(t.width,t.height)/2),this.setParentTransform(t)},r.CircleCollider.prototype._onTransformChanged=function(){r.CollisionShape.prototype._onTransformChanged.call(this),this._computeScaledRadius()},r.CircleCollider.prototype._computeScaledRadius=function(){this._scaledRadius=new r.Vector(this.radius,0).transform(this._localTransform).transform(this._parentTransform).sub(this.center).mag()},r.CircleCollider.prototype.draw=function(t){t.push(),t.noFill(),t.stroke(0,255,0),t.rectMode(t.CENTER),t.ellipse(this.center.x,this.center.y,2*this._scaledRadius,2*this._scaledRadius),t.pop()},r.CircleCollider.prototype.setParentTransform=function(t){if(t instanceof V)this._parentTransform.clear().scale(Math.max(t._getScaleX(),t._getScaleY())).rotate(F(t.rotation)).translate(t.position);else{if(!(t instanceof r.Transform2D))throw new TypeError("Bad argument to setParentTransform: "+t);this._parentTransform=t.copy()}this._onTransformChanged()},r.CircleCollider.prototype._getCandidateAxes=function(t){if(t instanceof r.OrientedBoundingBoxCollider||t instanceof r.AxisAlignedBoundingBoxCollider){var e=1/0,i=null,s=t.halfDiagonals;return[r.Vector.add(t.center,s[0]),r.Vector.add(t.center,s[1]),r.Vector.sub(t.center,s[0]),r.Vector.sub(t.center,s[1])].map(function(o){return o.sub(this.center)}.bind(this)).forEach(function(o){var a=o.magSq();a<e&&(e=a,i=o)}),[i]}return[r.Vector.sub(t.center,this.center)]},r.CircleCollider.prototype._getRadiusOnAxis=function(){return this._scaledRadius},r.CircleCollider.prototype._getMinRadius=function(){return this._scaledRadius},r.AxisAlignedBoundingBoxCollider=function(t,e,i){r.CollisionShape.call(this,t),this._width=e,this._height=i,this._halfDiagonals=[],Object.defineProperties(this,{width:{enumerable:!0,get:function(){return this._width}.bind(this),set:function(s){this._width=s,this._halfDiagonals=this._computeHalfDiagonals()}.bind(this)},height:{enumerable:!0,get:function(){return this._height}.bind(this),set:function(s){this._height=s,this._halfDiagonals=this._computeHalfDiagonals()}.bind(this)},halfDiagonals:{enumerable:!0,get:function(){return this._halfDiagonals}.bind(this)}}),this._computeHalfDiagonals()},r.AxisAlignedBoundingBoxCollider.prototype=Object.create(r.CollisionShape.prototype),r.AxisAlignedBoundingBoxCollider.createFromSprite=function(t,e,i,s){var o="number"==typeof i&&"number"==typeof s,a=new r.AxisAlignedBoundingBoxCollider(e,o?i:1,o?s:1);return a.getsDimensionsFromSprite=!o,a.updateFromSprite(t),a},r.AxisAlignedBoundingBoxCollider.prototype.updateFromSprite=function(t){this.getsDimensionsFromSprite&&(t.animation?(this._width=t.animation.getWidth(),this._height=t.animation.getHeight()):(this._width=t.width,this._height=t.height)),this.setParentTransform(t)},r.AxisAlignedBoundingBoxCollider.prototype._onTransformChanged=function(){r.CollisionShape.prototype._onTransformChanged.call(this),this._computeHalfDiagonals()},r.AxisAlignedBoundingBoxCollider.prototype._computeHalfDiagonals=function(){var t=r.Transform2D.mult(this._parentTransform,this._localTransform),e=[new r.Vector(this._width/2,-this._height/2),new r.Vector(this._width/2,this._height/2),new r.Vector(-this._width/2,this._height/2)].map(function(o){return o.transform(t).sub(this.center)}.bind(this)),i=Math.max(Math.abs(e[0].x),Math.abs(e[1].x)),s=Math.max(Math.abs(e[1].y),Math.abs(e[2].y));this._halfDiagonals=[new r.Vector(i,-s),new r.Vector(i,s)]},r.AxisAlignedBoundingBoxCollider.prototype.draw=function(t){t.push(),t.rectMode(t.CENTER),t.translate(this.center.x,this.center.y),t.noFill(),t.stroke(0,255,0),t.strokeWeight(1),t.rect(0,0,2*Math.abs(this._halfDiagonals[0].x),2*Math.abs(this._halfDiagonals[0].y)),t.pop()},r.AxisAlignedBoundingBoxCollider.prototype._getCandidateAxes=function(){return r.CollisionShape.WORLD_AXES},r.AxisAlignedBoundingBoxCollider.prototype._getRadiusOnAxis=function(t){return Math.max(r.Vector.project(this._halfDiagonals[0],t).mag(),r.Vector.project(this._halfDiagonals[1],t).mag())},r.AxisAlignedBoundingBoxCollider.prototype._getMinRadius=function(){return Math.min(this._width,this._height)},r.OrientedBoundingBoxCollider=function(t,e,i,s){r.CollisionShape.call(this,t,s),this._width=e,this._height=i,this._potentialAxes=[],this._halfDiagonals=[],Object.defineProperties(this,{width:{enumerable:!0,get:function(){return this._width}.bind(this),set:function(o){this._width=o,this._onTransformChanged()}.bind(this)},height:{enumerable:!0,get:function(){return this._height}.bind(this),set:function(o){this._height=o,this._onTransformChanged()}.bind(this)},halfDiagonals:{enumerable:!0,get:function(){return this._halfDiagonals}.bind(this)}}),this._onTransformChanged()},r.OrientedBoundingBoxCollider.prototype=Object.create(r.CollisionShape.prototype),r.OrientedBoundingBoxCollider.createFromSprite=function(t,e,i,s,o){var a="number"==typeof i&&"number"==typeof s,h=new r.OrientedBoundingBoxCollider(e,a?i:1,a?s:1,o);return h.getsDimensionsFromSprite=!a,h.updateFromSprite(t),h},r.OrientedBoundingBoxCollider.prototype.updateFromSprite=r.AxisAlignedBoundingBoxCollider.prototype.updateFromSprite,r.OrientedBoundingBoxCollider.prototype.updateSweptColliderFromSprite=function(t){var e=t.velocity.mag(),i=new r.Vector(t.velocity.y,-t.velocity.x);this._width=e+2*t.collider._getRadiusOnAxis(t.velocity),this._height=2*t.collider._getRadiusOnAxis(i);var s=F(t.getDirection()),o=new r.Vector(t.newPosition.x+.5*t.velocity.x,t.newPosition.y+.5*t.velocity.y);this._localTransform.clear().scale(this._scale).rotate(s).translate(this._offset).translate(r.Vector.mult(this._center,-1)).translate(o),this._onTransformChanged()},r.OrientedBoundingBoxCollider.prototype._onTransformChanged=function(){r.CollisionShape.prototype._onTransformChanged.call(this);var t=r.Transform2D.mult(this._parentTransform,this._localTransform),e=[new r.Vector(this._width/2,-this._height/2),new r.Vector(this._width/2,this._height/2),new r.Vector(-this._width/2,this._height/2)].map(function(i){return i.transform(t)});this._halfDiagonals=[r.Vector.sub(e[0],this.center),r.Vector.sub(e[1],this.center)],this._potentialAxes=[r.Vector.sub(e[1],e[2]),r.Vector.sub(e[1],e[0])]},r.OrientedBoundingBoxCollider.prototype.draw=function(t){var e=r.Transform2D.mult(this._localTransform,this._parentTransform),i=e.getScale(),s=e.getRotation();t.push(),t.translate(this.center.x,this.center.y),t.scale(i.x,i.y),t.rotate(t._angleMode===t.RADIANS?s:ft(s)),t.noFill(),t.stroke(0,255,0),t.strokeWeight(1),t.rectMode(t.CENTER),t.rect(0,0,this._width,this._height),t.pop()},r.OrientedBoundingBoxCollider.prototype._getCandidateAxes=function(){return this._potentialAxes},r.OrientedBoundingBoxCollider.prototype._getRadiusOnAxis=r.AxisAlignedBoundingBoxCollider.prototype._getRadiusOnAxis,r.OrientedBoundingBoxCollider.prototype._getMinRadius=r.AxisAlignedBoundingBoxCollider.prototype._getMinRadius,r.Transform2D=function(t){if(6!==(t=t||[1,0,0,0,1,0]).length)throw new TypeError("Transform2D must have six components");this.length=6,this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5]},r.Transform2D.prototype=Object.create(Array.prototype),r.Transform2D.prototype.clear=function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this},r.Transform2D.prototype.copy=function(){return new r.Transform2D(this)},r.Transform2D.prototype.equals=function(t){if(!(t instanceof r.Transform2D||Array.isArray(t)))return!1;for(var e=0;e<6;e++)if(this[e]!==t[e])return!1;return!0},r.Transform2D.mult=function(t,e,i){var s,o,a,h,u,f,y,x,c,w,p,b;return i=i||new r.Transform2D,a=t[2],h=t[3],u=t[4],f=t[5],x=e[1],c=e[2],p=e[4],b=e[5],i[0]=(s=t[0])*(y=e[0])+(o=t[1])*(w=e[3]),i[1]=s*x+o*p,i[2]=s*c+o*b+a,i[3]=h*y+u*w,i[4]=h*x+u*p,i[5]=h*c+u*b+f,i},r.Transform2D.prototype.mult=function(t){return r.Transform2D.mult(this,t,this)},r.Transform2D.prototype.translate=function(t,e){var i,s;if(t instanceof r.Vector)i=t.x,s=t.y;else{if("number"!=typeof t||"number"!=typeof e){for(var o="",a=0;a<arguments.length;a++)o+=arguments[a]+", ";throw new TypeError("Invalid arguments to Transform2D.translate: "+o)}i=t,s=e}return r.Transform2D.mult([1,0,i,0,1,s],this,this)},r.Transform2D.prototype.getTranslation=function(){return new r.Vector(this[2],this[5])},r.Transform2D.prototype.scale=function(t,e){var i,s;if(t instanceof r.Vector)i=t.x,s=t.y;else if("number"==typeof t&&"number"==typeof e)i=t,s=e;else{if("number"!=typeof t)throw new TypeError("Invalid arguments to Transform2D.scale: "+arguments);i=t,s=t}return r.Transform2D.mult([i,0,0,0,s,0],this,this)},r.Transform2D.prototype.getScale=function(){var t=this[0],e=this[1],i=this[3],s=this[4];return new r.Vector(pt(t)*Math.sqrt(t*t+e*e),pt(s)*Math.sqrt(i*i+s*s))},r.Transform2D.prototype.rotate=function(t){if("number"!=typeof t)throw new TypeError("Invalid arguments to Transform2D.rotate: "+arguments);var e=Math.sin(t),i=Math.cos(t);return r.Transform2D.mult([i,-e,0,e,i,0],this,this)},r.Transform2D.prototype.getRotation=function(){return Math.atan2(-this[1],this[0])},r.Vector.transform=function(t,e){return t.copy().transform(e)},r.Vector.prototype.transform=function(t){var e=this.x,i=this.y;return this.x=t[0]*e+t[1]*i+t[2],this.y=t[3]*e+t[4]*i+t[5],this}});